<%--  onclick="openLocking();"--%>
<%-- 系统锁定 开始--%>
<!-- 锁定系统层
<iframe id="lockframe" onload="CheckLock();" style="left: 0px; position: absolute;
    top: 0px; display: none; width: 110%; height: 120%" src="" scrolling="no" marginheight="0"
    marginwidth="0" ></iframe>
     -->
     <input type="hidden" id="loginFlag" value="${loginFlag }" />
<!-----------------  锁定层  --------------------->
<div class="locking" style="display:none;"><!-- 默认让锁定层隐藏 -->
	<div class="login_main">
			<!------------------ 锁定层 头部 -------------------->
			<div class="locking_header">
				<span width="21%">
					<a href="#">手机版</a>
				</span>|
				<span width="29%">
					<a href="javascript:showLoginMethod();" class="change_login">密码登录</a>
					<span onclick="showLoginMethod();" class="down"><img src="../images/finallogin/down.png" /></span>
				</span>&nbsp;&nbsp;|
				<span width="29%">
					<a href="javascript:showChoiceLanguage();" class="change_language">中文简体</a>
					<span onclick="showChoiceLanguage();" class="down"><img src="../images/finallogin/down.png" /></span>
				</span>&nbsp;&nbsp;|
				<span width="21%">
					<a href="#">环境设置</a>
				</span>
			</div>
			<!-- 登录方式隐藏弹出DIV -->
			<div class="locking_method">
				<table width="100%" border="0" cellspacing="0">
					<tr>
						<td onclick="getPwd();">密码登录</td>
					</tr>
					<tr>
						<td onclick="getEpass();">Epass登录</td>
					</tr>
				</table>
			</div>
			<!-- 选择语言隐藏弹出DIV -->
			<div class="choice_language" style="left:480px;">
				<table width="100%" border="0" cellspacing="0">
					<tr>
						<td onclick="getCnSimple();">简体中文</td>
					</tr>
					<tr>
						<td onclick="getCnTra();">繁体中文</td>
					</tr>
					<tr>
						<td onclick="getEn();">English</td>
					</tr>
				</table>
			</div>
			
			<!------------------------- 系统锁定状态页面 主体 ---------------------------->
			<div class="locking_sys">
				<div class="user_photo_bg">
					<div class="user_photo"></div>
				</div>
				<div class="user_name">
					${loginUser.userName }
				</div>
				<div class="user_id">
					${loginUser.accounts }
				</div>
				<div class="locking_pic" id="unlock" onmouseover="showUnLock();" onmouseout="outUnLock();" onclick="goNext();">
				</div>
				<div id="unlocking" style="margin-top:130px;right:-30px;position:absolute;">
					<table>
						<tr>
							<td>解锁密码:</td>
						</tr>
						<tr>
							<td>
								<input id='lockingPwd' type='password' style='border:1px solid #999999;width:230px;height:32px;line-height: 32px;font-size: 18px;' value=''/>
							</td>
						</tr>
						<tr >
							<td align="center">
								<div style="margin-top:22px;">
									<input type='button' class='buttonActive' data-width='standard' value='确定' onclick='checkPwd();'/>
									<input type='button' class='buttonPro' data-width='standard' value='取消' onclick='cancelUnlock();'/>
								</div>
							</td>
						</tr>
					</table>
				</div>
			</div>
				
			<div class="locking_txt">您的系统正在锁定中</div>
			</div>
</div>
<script type="text/javascript">
function openLocking(){
	jQuery(".locking").css("display","");
	$("#d_jcs").css("display","none");
	$(".jc6_jcs").css("display","none");
	$(".jc6ui-jcs").css("display","none");
	$("#unlock").show();
	$(".locking_txt").show();
	$("#unlocking").hide();
	//给锁定位赋值
	window.name='lock';
	//var imageSrc='${loginUser.userImg}';
	//alert(imageSrc);
	jQuery(".login_main .locking_sys .user_photo").css("background-image","url('${ctx}${loginUser.userImg}')");
};

//点击弹出相应的DIV层
function showLoginMethod(){
	jQuery(".locking_method").slideToggle("fast");
};
function showChoiceLanguage(){
	jQuery(".choice_language").slideToggle("fast");
};
//更换登录方式DIV选择单击事件
function getPwd(){
	jQuery(".change_login").html("密码登录");
	$(".locking_method").css("display","none");
};
function getEpass(){
	jQuery(".change_login").html("Epass登录");
	$(".locking_method").css("display","none");
};
//更换语言DIV选择单击事件
function getCnSimple(){
	jQuery(".change_language").html("简体中文");
	$(".choice_language").css("display","none");
};
function getCnTra(){
	jQuery(".change_language").html("繁体中文");
	$(".choice_language").css("display","none");
}
function getEn(){
	jQuery(".change_language").html("English");
	$(".choice_language").css("display","none");
};

function showUnLock(){
	jQuery(".locking_pic").html("解锁");
};
function outUnLock(){
	jQuery(".locking_pic").html("");
};

function goNext(){
	//alert("111");
	$("#lockingPwd").val('');
	$("#unlock").hide();
	$(".locking_txt").hide();
	$("#unlocking").show();
	//var div = $("<input id='lockingPwd' type='password' style='border:1px solid #999999;width:100px;' value='' />");
	//var addbtn = $("<div title='解锁' id='buttondiv' onclick='checkPwd();' onmouseover='javascript:unlockhover();' onmouseout='javascript:unlockleave();' style='width:42px; height:42px; position:absolute; top:8px; left:200px; font-size:12px; background:url(../images/finallogin/unlock-btn.png); background-position:0 0; cursor:pointer;'></div>");
	//var addbtn = $("<div id='buttondiv'><input type='button' class='buttonActive' data-width='standard' value='确定' onclick='checkPwd();' onmouseover='javascript:unlockhover();'/></div>");
	//var addbtn = $("<input id='buttondiv' type='button'lass='buttonAvtive' data-width="standard" value='确定'/>");
	//$(".locking_txt").html("解锁密码:<br/>");
	//$(".locking_txt").append(div);
	//$(".locking_txt").append(addbtn);
	//alert(window.name);
	document.getElementById('lockingPwd').focus();
	document.onkeydown=function(event){e = event ? event :(window.event ? window.event : null);if(e.keyCode==13){ checkPwd();}};
};
//锁定状态通过ajax获取密码
function checkPwd(){
	var userName="${loginUser.accounts }";
	var pwd = $("#lockingPwd").val();
	if(pwd != ""){
		$.ajax({
			url: "${ctx}/adm/login!login.action",
			type: "POST",
			data: "accounts="+userName+"&password="+pwd,
			success:function(obj) {
			    if(obj.success=='1'){//login successfully
			    	//隐藏锁定层
					$(".locking").css("display","none");
					window.name='';
					document.onkeydown=function(event){e = event ? event :(window.event ? window.event : null);if(e.keyCode==13){ return false;}};
					$(".jc6_jcs").css("display","");
					$("#d_jcs").css("display","");
					//$(".jc6ui-jcs").css("display","");
			    }else{
			    	//登录验证失败
			    	$(window.top.document.body).stateBox({
						state: "alert",     							
						content: obj.msg, //"密码错误,请重新输入!",
						corner: true
		  				});
			    }
			}
		});	
	}else{
		$(window.top.document.body).stateBox({
			state: "alert",     							
			content: "密码错误,请重新输入!",
			corner: true
		});
	}
	//恢复成以前的'您的系统正在锁定中'
	$(".locking_txt").html("您的系统正在锁定中");
	$(".locking_txt").children().eq(0).remove();
	$(".locking_txt").children().eq(1).remove();
};

function cancelUnlock(){
	$("#unlock").show();
	$(".locking_txt").show();
	$("#unlocking").hide();
};

//解锁btn样式hover
function unlockhover(){
	$("#buttondiv").css({
		'width':'42px', 
		'height':'42px', 
		'position':'absolute', 
		'top':'8px', 'left':'200px', 'font-size':'12px', 
		'background':'url(../images/finallogin/unlock-btn.png)', 
		'background-position':'0 -42px'
	});
};
function unlockleave(){
	$("#buttondiv").css({
		'width':'42px', 'height':'42px', 'position':'absolute', 
		'top':'8px', 'left':'200px', 'font-size':'12px', 
		'background':'url(../images/finallogin/unlock-btn.png)', 
		'background-position':'0 0'
	});
};
</script>
<%-- 系统锁定 结束--%>