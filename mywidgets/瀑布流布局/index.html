<!DOCTYPE HTML>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>绝对定位布局</title>
<style type="text/css">
	.wrap{
		margin:20px auto ;
		position:relative ;
	}
	.cell{
		border:1px solid #ccc ;
		border-radius:8px ;
		box-shadow:2px 2px 5px #ccc ;
		overflow:hidden ;
		padding:10px ;
		position:absolute ;
		text-decoration:none ;
	}
	.cell img{
		width:190px ;
	}
	.desc{
		color:#878787 ;
		display:block ;
		margin:10px 0 0 ;
		width:100% ;
	}
</style>
</head>

<body>
	<!--
    	绝对定位实现方式因为要获取每格的高度，然后根据高度来计算定位位置，所以必须要知道图片的高度，如果没有高度，定位就不准确，所以传递数据的时候需要图片的高度。
　　		我是这样计算绝对定位的位置的，left根据列数来，这个略过，下面主要讲TOP值的获取：
    　　 比如如下的排列方式，数字代表格子
    
    　　		0    1     2     3    4     5
    
          	6    7    8    9     10   11
    
         	12   13  14   15   16   17

    	第12格子的绝对定位TOP值 =  第0格的高度（offsetHeight） + 相隔距离(margin) + 6格的高度(offsetHeight) + 相隔距离(margin)；
    -->
	<div class="wrap" id="wrap">
    	<!--<a href="#" class="cell">
        	<img src="images/1.jpg" />
            <span class="desc">111111</span>
        </a>
        <a href="#" class="cell" style="left:230px;">
        	<img src="images/2.jpg" />
            <span class="desc">222222</span>
        </a>-->
    </div>
    <script language="javascript">
    	/*waterFall = function(name){
			this.name = name ;
		}
		waterFall.prototype = {
			fun1 : function(){
				console.log('fun1') ;
			},
			fun2 : function(){
				return 'fun2' ;
			}
		}
		var per = new waterFall('gg') ;
		per.fun1() ;		
		console.log(per.name) ;
		console.log(per.fun2()) ;*/
		
		
		waterFall = function(option){
			this.imgWidth = option.imgWidth || 190 ;
			this.colPadding = option.colPadding || 10 ;
			this.colBorder = option.colBorder || 1 ;
			this.colMarginRight = option.colMarginRight || 20 ;
			this.initTop = option.initTop || 0 ;
			this.yOtherHei = option.yOtherHei || 32 ;
			
			//每个item 宽度
			this.ceilWidth = this.imgWidth +  this.colPadding*2 + this.colBorder*2 ;
			//ceilTrueWidth:item实际宽度+右边距， 用于计算left坐标以及列数获取使用
			this.ceilTrueWidth = this.ceilWidth + this.colMarginRight ;
			this.heightArray = [] ; //记录每列高度的数组。方便获取最小高度列使用
			this.colNumAry = [] ; //记录每列放入item的个数。方便设置top值使用
			
			this.bodyWidth = document.body.clientWidth ;
			this.objId = option.objId || 'wrap' ;
			this.init(itemList) ;
		}
		
		waterFall.prototype = {
			/*获取列数*/
			getCol : function(){
				var col = Math.floor(this.bodyWidth / this.ceilTrueWidth) ;
				return col ;
			} ,
			/*设置横坐标*/
			setPosLeft : function(obj,left){
				obj.style.left = left + 'px' ;
			} ,
			/*设置纵坐标*/
			setPosTop : function(obj,top){
				obj.style.top = top + 'px' ;
			},			
			/*获取横坐标*/
			getPosLeft : function(index){
				return index*this.ceilTrueWidth ;
			},
			/*存入ceil个数值*/	
			setColNum : function(index,count){
				console.log(count) ;
				this.colNumAry[index] = count;
			} ,
			/*设置列高度*/	
			setColHeight : function(index,colhei){
				this.heightArray[index] = colhei;
			} ,
			/*获取高度最小列*/
			getMinColHeight : function(ary){
				var minHei = ary[0] ;
				var index = 0 ;
				var aryLen = ary.length ;
				for(var i=0; i<aryLen;i++){
					if(ary[i] < minHei){
						minHei = ary[i] ;						
						index = i ;
					}
				}
				return index ;
			} ,
			/*插入item*/
			insertItem : function(i,itemList){
				var a = document.createElement('a') ;
				a.id = itemList[i].id ;
				a.setAttribute('class','cell') ;
				var img = document.createElement('img') ;
				img.src = itemList[i].src ;
				var span = document.createElement('span') ;
				span.setAttribute('class','desc') ;
				span.innerHTML = itemList[i].spanhtml ;
				a.appendChild(img) ;
				a.appendChild(span) ;
				return a ;
			} ,
			/*初始化*/
			init : function(itemList){
				var col = this.getCol() ;
				var len = itemList.length ;
				var wrap = document.getElementById(this.objId) ;
				var left,top ;
				for(var i=0; i<len; i++){
					var a = this.insertItem(i,itemList) ;
					if(i<col){
						this.setColHeight(i,parseInt(itemList[i].imgheight) + parseInt(this.yOtherHei)) ;
						this.setColNum(i,1) ;
						left = this.getPosLeft(i%col) ;
					}else{
						var index = this.getMinColHeight(this.heightArray) ;
						top = this.heightArray[index] + parseInt(this.yOtherHei)*this.colNumAry[index] + this.initTop ;
						this.setColNum(index,this.colNumAry[index]+1) ;
						this.setColHeight(index,(parseInt(this.heightArray[index]) + parseInt(itemList[i].imgheight)) + parseInt(this.yOtherHei)) ;
						left = this.getPosLeft(index) ;	
					}
					this.setPosLeft(a,left) ;
					this.setPosTop(a,top) ;
					wrap.appendChild(a) ;
				}
			}
		}
		
		itemElem = function(id,src,spanhtml,imgheight){
			this.id = id ;
			this.src = src ;
			this.spanhtml = spanhtml ;
			this.imgheight = imgheight ;
		}
		
		var itemList = [
			new itemElem('item1','images/1.jpg','我是第111111个',270) ,
			new itemElem('item2','images/2.jpg','我是第222222个',143) ,
			new itemElem('item3','images/3.jpg','我是第333333个',166) ,
			
			new itemElem('item4','images/4.jpg','我是第444444个',275) ,
			new itemElem('item5','images/5.jpg','我是第555555个',285) ,
			new itemElem('item6','images/6.jpg','我是第666666个',272) ,
			
			new itemElem('item7','images/7.jpg','我是第777777个',285) ,
			new itemElem('item8','images/8.jpg','我是第888888个',279) ,
			new itemElem('item9','images/9.jpg','我是第999999个',190) ,
			
			new itemElem('item10','images/10.jpg','我是第aaaaaa个',236) ,
			new itemElem('item11','images/11.jpg','我是第bbbbbb个',225) ,
			new itemElem('item12','images/12.jpg','我是第cccccc个',264) ,
			
			new itemElem('item13','images/13.jpg','我是第dddddd个',143) ,
			new itemElem('item14','images/14.jpg','我是第eeeeee个',190) ,
			new itemElem('item15','images/15.jpg','我是第ffffff个',339) 
		] ;
		var myWaterFall = new waterFall({
			objId : 'wrap'
			
		}) ;
    </script>
</body>
</html>
