<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>快捷桌面帮助</title>
<link rel="stylesheet" type="text/css" href="reset.css">
<link rel="stylesheet" type="text/css" href="../js/jquery/jquery-ui-1.8.4.custom.css">
<script src="../js/jquery/c6-base.js"></script>
<style>
body {
	overflow: hidden;
}
#helpCon {
	height: 0;
	width: 0;
	overflow: visible;
	display:none;
}
.help-overlay {
	position: absolute;
	top: 0;
	left: 0;
	width: 100%;
	height: 100%;
	background-color: #000;
	opacity: .8;
	filter: Alpha(Opacity=80);
}
.help-1, .help-2, .help-3, .help-4, .help-5, .help-skip {
	position: absolute;
	background: url(../image/help.png) no-repeat;
	cursor: pointer;
}
.help-1 {
	height: 146px;
	width: 572px;
	background-position: 0 0;
	margin: 0 38%;
}
.help-2 {
	height: 148px;
	width: 572px;
	background-position: 0 -143px;
	margin: 0 38%;
}
.help-3 {
	height: 154px;
	width: 572px;
	background-position: 0 -296px;
	margin: 150px 20%;
}
.help-4 {
	height: 190px;
	width: 572px;
	background-position: 0 -444px;
	margin: 0 38%;
}
.help-5 {
	height: 246px;
	width: 572px;
	background-position: 0 -647px;
	margin: 0 30%;
	bottom:20px;
}
.help-skip {
	background-position: 0 -902px;
	height: 50px;
	width: 100px;
	bottom: 20px;
	right: 20px;
	position: fixed;
}
#showHelp{ height:21px; width:21px; background-image:url(image/helpIco.png); position:absolute; top:20px; right:20px; text-indent:-9999px;}
.notificationInfo{ height:50px; width:240px; background-color:#FCFDCA; color:#360; position:absolute; left:200px; top:2px; line-height:16px; font-weight:bold; padding:10px;}
</style>
<script>
$(function(){
	//隐藏帮助视图
	function helpHide(){
		$("#helpCon").fadeOut(300,function(){
			$("#help-content").attr("class","help-1");
		});
		showNotifications('image/notificationIcon.png','帮助','开启了桌面通知功能！',2000);
	}
	//显示帮助视图
	function helpShow(){
		$("#helpCon").show(300);
	}
	//处理帮助序列
	$("#help-content").click(function(){
		var $this = $(this);
		var $attr = $this.attr("class");
		var i = parseInt($attr.slice(5),10);
		if(i < 5){
			i++;
			$this.fadeOut(300,function(){
				$this.attr("class","help-" + i).fadeIn(300);
			});
		}else{
			helpHide();
		}
	});
	//跳过
	$("#help-skip").click(function(){
		helpHide();
	});
	//激活帮助视图
	$("#showHelp").click(function(){
		helpShow();
		checkPermission();
	});
	
});

//网页通知（only Chrome）
window.Notifications = window.Notifications || window.webkitNotifications;

function showNotifications(icon,title,message,timer){
	//参数：图标路径(32*32),标题,详细信息,延时关闭(毫秒)
	var newNotification = Notifications.createNotification(icon,title,message);
	newNotification.ondisplay = function(){
		var temp = this;
		var fn = function() { temp.cancel(); };
		timer = timer || 3000;
		window.setTimeout(fn, timer);
	}
	newNotification.show();
}

function checkPermission(){
	//开启网页通知的权限
	var $info = $("<div class='notificationInfo'>点击'允许'可以通过桌面通知获取更多的实时帮助！</div>");
	if (window.Notifications) {
		var permissionLevel = window.Notifications.checkPermission();
		if(permissionLevel == 0){
			$(".notificationInfo").remove();
			//showNotifications('image/notificationIcon.png','帮助','"桌面通知"可以为您提供更多的实时帮助信息！！',10000);
		}else if(permissionLevel == 1){
			window.Notifications.requestPermission(checkPermission);
			$("body").append($info);
		}else{
			//世界清静了！！
		}
	}
}
//一个延时信息调用的测试
//setTimeout(showNotifications,10000,'image/notificationIcon.png','我的自定义','详细内容',3000);

</script>
</head>

<body>

<a id="showHelp" href="javascript:void(0)" title="帮助">?</a>
<div id="helpCon">
  <div class="help-overlay"></div>
  <div id="help-content" class="help-1"></div>
  <div id="help-skip" class="help-skip"></div>
</div>
</body>
</html>
