<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<title>File Transfer Example</title>  

<script type="text/javascript" charset="utf-8" src="cordova.js"></script>
<script type="text/javascript" charset="utf-8">

	// 等待加载PhoneGap
	document.addEventListener("deviceready", onDeviceReady, false); 
	
	// PhoneGap加载完成
	function onDeviceReady() { 

		//从照相机拍照			
		//navigator.camera.getPicture(uploadPhoto, 
		//							function(message) { alert('get picture failed'); },
		// 							{ quality: 50,
        //							destinationType: navigator.camera.DestinationType.DATA_URL,
        //							sourceType: navigator.camera.PictureSourceType.CAMERA,
        //							isNeedCrop: true }
        //							);
		
        
        // 从指定来源检索图像文件位置
		//navigator.camera.getPicture(uploadPhoto, 
		//							function(message) { alert('get picture failed'); }, 
		//							{ quality: 50,  
		//							destinationType: navigator.camera.DestinationType.FILE_URI, 
		//							sourceType: navigator.camera.PictureSourceType.PHOTOLIBRARY,
		//							isNeedCrop: true}
		//							);			
	}
	
	function uploadPhoto(imageURI) { 
		var options = new FileUploadOptions(); 
		options.fileKey="pic"; 
		options.fileName=imageURI.substr(imageURI.lastIndexOf('/')+1); 
		options.mimeType="image/jpeg"; 

		var params = new Object(); 
		params.value1 = "test"; 
		params.value2 = "param";  

		options.params = params;  

		var ft = new FileTransfer(); 
		ft.upload(imageURI, "http://10.6.210.229:8080/wiki/upload", win, fail, options);
	} 

	function win(r) { 
		console.log("Code = " + r.responseCode);
		console.log("Response = " + r.response); 
		console.log("Sent = " + r.bytesSent); 
	} 

	function fail(error) { 
		alert("An error has occurred: Code = " = error.code);
	}  
	
	function getAccessToken() {
      spApi.getAccessToken(success,onFail);
    }
    
    function onFail(message) {
      alert('Failed because: ' + message);
    }
    
    function success(result) {
      //todo 
      alert('get result: ' + result);
    }
    
    function selectorDialogCallback(result) {
      if(result == 1){//照相
        //从照相机拍照			
		navigator.camera.getPicture(uploadPhoto, 
									function(message) { alert('get picture failed'); },
		 							{ quality: 50,
        							destinationType: navigator.camera.DestinationType.DATA_URL,
        							sourceType: navigator.camera.PictureSourceType.CAMERA,
        							isNeedCrop: true }
        							);
      }else if(result == 2){//图库
         // 从指定来源检索图像文件位置
		navigator.camera.getPicture(uploadPhoto, 
									function(message) { alert('get picture failed'); }, 
									{ quality: 50,  
									destinationType: navigator.camera.DestinationType.FILE_URI, 
									sourceType: navigator.camera.PictureSourceType.PHOTOLIBRARY,
									isNeedCrop: true}
									);	
      }
    }
    
    function uploadImage() {
       alert('get result: ' + device.platform);
      window.FileTransfer.photoSelector(selectorDialogCallback,onFail);
    }
    

</script>
</head>
<body>
	<h1>Example</h1>
	<p>Upload File</p>
	
	 <button onclick="getAccessToken();">getAccessToken</button> <br>
     <hr color="red"> 
     
     <button onclick="uploadImage();">uploadImage</button> <br>
     <hr color="red"> 
</body>
</html>